<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MarterNeri – Tracking Spedizioni</title>
  <link rel="stylesheet" href="./css/style.css?v=11">
</head>
<body>

  <!-- SIDEBAR -->
  <aside class="sb" id="sidebar">
    <div class="sb-header">
      <img src="./media/FHP_Group_Logo_RGB.png" alt="FHP Group" class="logo" />
      <span class="brand">MarterNeri</span>
    </div>

    <nav class="sb-nav">
      <a href="index.html" class="sb-btn">
        <img src="./media/italia.jpg" alt="IT" class="btn-icon-img" />
        <span class="btn-text">Italia</span>
      </a>
      <a href="index.html" class="sb-btn">
        <img src="./media/eu.png" alt="EU" class="btn-icon-img" />
        <span class="btn-text">Europa</span>
      </a>
      <a href="index.html" class="sb-btn">
        <img src="./media/sailposticona3200.png" alt="World" class="btn-icon-img" />
        <span class="btn-text">Extra-UE</span>
      </a>
      <a href="index.html" class="sb-btn">
        <img src="./media/dollaro260.png" alt="US" class="btn-icon-img" />
        <span class="btn-text">USA</span>
      </a>
      <a href="track.html" class="sb-btn active">
        <img src="./media/corrire.png" alt="Track" class="btn-icon-img" />
        <span class="btn-text">Track</span>
      </a>
    </nav>

    <div class="sb-footer">
      <small>v1.0 • MarterNeri</small>
    </div>
  </aside>

  <!-- OVERLAY mobile -->
  <div class="overlay" id="overlay"></div>

  <!-- MAIN -->
  <main class="main track-page">
    <!-- Tabella Spedizioni -->
    <section id="griglia-spedizioni" class="shipping-table-section">
      <h2>Tabella Spedizioni</h2>
      <table class="shipping-table">
        <thead>
          <tr>
            <th>Mittente</th>
            <th>Destinatario</th>
            <th>N° Tracking / Link</th>
            <th>Apri</th>
            <th>Copia</th>
          </tr>
        </thead>
        <tbody id="tabella-body">
          <tr>
            <td><input type="text"></td>
            <td><input type="text"></td>
            <td><input type="text" placeholder="N° tracking o URL"></td>
            <td><button class="apri-link">Vai</button></td>
            <td><button class="copia-link">Copia</button></td>
          </tr>
        </tbody>
      </table>
      <button id="aggiungi-riga" class="add-row-btn">+ Aggiungi riga</button>
    </section>
  </main>

  <!-- JavaScript tabella spedizioni -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const btn = document.getElementById('aggiungi-riga');
      const body = document.getElementById('tabella-body');

      // Aggiungi riga alla tabella
      if (btn) {
        btn.addEventListener('click', () => {
          const righe = body.querySelectorAll('tr').length;
          if (righe >= 10) {
            alert('Hai raggiunto il massimo di 10 righe');
            return;
          }

          const nuovaRiga = document.createElement('tr');
          nuovaRiga.innerHTML = `
            <td><input type="text"></td>
            <td><input type="text"></td>
            <td><input type="text" placeholder="N° tracking o URL"></td>
            <td><button class="apri-link">Vai</button></td>
            <td><button class="copia-link">Copia</button></td>
          `;
          body.appendChild(nuovaRiga);
        });
      }

      // Funzione per costruire URL di tracking
      function buildTrackingUrl(input) {
        if (!input) return null;

        input = input.trim();

        // Se contiene già http/https, è un URL completo
        if (input.match(/^https?:\/\//i)) {
          return input;
        }

        // Riconosci tracking UPS (inizia con "1Z" seguito da caratteri alfanumerici)
        if (/^1Z[A-Z0-9]+$/i.test(input)) {
          return `https://www.ups.com/track?track=yes&trackNums=${input}&loc=it_IT&requester=ST/trackdetails`;
        }

        // Riconosci tracking DHL (10-11 cifre)
        if (/^\d{10,11}$/.test(input)) {
          return `https://www.dhl.com/it-en/home/tracking.html?tracking-id=${input}&submit=1`;
        }

        // Se è solo numerico con 12+ cifre, assumiamo sia un tracking FedEx
        if (/^\d{12,}$/.test(input)) {
          // Costruisci URL FedEx con il formato fornito dall'utente
          return `https://www.fedex.com/fedextrack/duplicate-results/select?duplicateTrackingId=${input}&trknbr=${input}`;
        }

        // Se sembra un URL senza protocollo, aggiungi https://
        if (input.includes('.') && !input.includes(' ')) {
          return `https://${input}`;
        }

        // Altrimenti, prova a costruire un URL generico
        if (/^\d+$/.test(input)) {
          return `https://www.fedex.com/fedextrack/?trknbr=${encodeURIComponent(input)}`;
        }

        return null;
      }

      // Gestione pulsante "Vai" per aprire link
      document.addEventListener('click', e => {
        if (e.target.classList.contains('apri-link')) {
          const row = e.target.closest('tr');
          const inputs = row.querySelectorAll('input[type="text"]');
          const trackingInput = inputs[2]; // Il terzo input è il tracking
          const input = trackingInput ? trackingInput.value : '';
          const trackingUrl = buildTrackingUrl(input);

          if (trackingUrl) {
            window.open(trackingUrl, '_blank');
          } else {
            alert('Inserisci un numero di tracking o un link valido');
          }
        }

        // Gestione pulsante "Copia" per copiare URL negli appunti
        if (e.target.classList.contains('copia-link')) {
          const row = e.target.closest('tr');
          const inputs = row.querySelectorAll('input[type="text"]');
          const trackingInput = inputs[2]; // Il terzo input è il tracking
          const input = trackingInput ? trackingInput.value : '';
          const trackingUrl = buildTrackingUrl(input);

          if (trackingUrl) {
            // Copia negli appunti
            navigator.clipboard.writeText(trackingUrl).then(() => {
              const btn = e.target;
              const originalText = btn.textContent;
              btn.textContent = '✓ Copiato!';
              btn.style.backgroundColor = '#28a745';

              // Ripristina il testo originale dopo 2 secondi
              setTimeout(() => {
                btn.textContent = originalText;
                btn.style.backgroundColor = '';
              }, 2000);
            }).catch(err => {
              alert('Errore durante la copia: ' + err);
            });
          } else {
            alert('Inserisci un numero di tracking o un link valido');
          }
        }
      });
    });
  </script>
</body>
</html>
